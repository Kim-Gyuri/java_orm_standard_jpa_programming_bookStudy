## JPA에서 가장 중요한 2가지 
+ 객체와 관계형 데이터베이스 매핑하기 (Object Relational Mapping)
+ 영속성 컨텍스트
> `객체와 RDB 맵핑`은 매핑과정으로 정적이다, `DB를 어떻게 설계하고 객체를 어떻게 설계해서 중간에 맵핑해서 쓸 것`에 대해 초점을 두고 <br>
> `영속성 컨텍스트`는 `실제 내부에서 어떻게 동작하는지?`에 대한 것이다.
<br>

> 이번 내용의 목표는 `JPA가 내부적으로 어떻게 동작하는지?` 중심으로 이해하기

## 엔티티 매니저 팩토리와 엔티티 매니저
![영속성 컨텍스트1](https://user-images.githubusercontent.com/57389368/158953144-45ed46e3-3e9c-45ac-bf86-7afd4eea8fb8.JPG) <br>
``` 그림설명 : 웹 애플리케이션을 개발할 경우 ```
+ emf(EntityManagerFactory)를 통해서 고객요청이 올때마다 em(EntityManager)를 생성한다.
+ em는 내부적으로  DB 커넥션풀을 사용해서 DB를 사용하게 된다.

## 영속성 컨텍스트
+ JPA를 이해하는데 가장 중요한 용어
+ ``` 엔티티를 영구저장하는 환경 이라는 뜻으로, ```
+ ``` EntityManager.persist(entity); ``` : em.persist()를 호출해서 엔티티를 집어 넣으면 엔티티 객체를 DB에 저장한다. 

> 사실 DB에 저장한다는 게 아니라, 영속성 컨텍스트를 통해서 엔티티를 영속한다는 의미로, <br> 더 정확하게, 'persist메소드는 DB에 저장한다.' 의미가 아니라 ``` 엔티티를 영속성 컨텍스트에 저장한다는 의미이다. ```

## 엔티티 매니저? 영속성 컨텍스트?
``` 영속성 컨텍스트란? ``` 
+ 영속성 컨텍스트는 논리적인 개념이다.
+ 눈에 보지이 않는다.
+ 엔티티 매니저를 통해서 영속성 컨텍스트에 접근할 수 있다.

> 이게 무슨 뜻이냐?, 지난번 수업에서 J2SE환경에서 em을 생성하면 그 안에 1:1로 PersistenceContext가 생성되었다. <br> 쉽게 말하면, em 안에 영속성 컨텍스트라는 눈에 보이지 않는 공간이 생긴다고 이해하면 쉽다.

## 엔티티의 생명주기
+ ``` 비영속 상태 ``` <br> member객체를 생성했고 em에 아무것도 안 넣었을 때, 이 경우는 JPA와 관계없고 객체를 생성한 상태이다.
+  ``` 영속 상태 ``` <br> em 안에 member객체를 저장한다. (객체생성하여 em을 얻어 와서 persist로 member를 집어넣는다. ---> "em.persist(member);")
> `비영속 상태` : JPA와 관련없이 DB에 안 들어온 상태 <br>  `영속 상태` : 'em.persist'를 하면 DB에 저장된다고 했지만, '사실 DB에 저장 안 되었다.' 
``` 
  ----Before---- 

  em.persist(); 
  
  ----After----
```

+ 'Before ~ After' 사이에 아무것도 DB에 저장되지 않았다. (쿼리실행 없었다.)
+ 그런데, After 이후에 insert 쿼리가 나왔을까?
+ ``` 영속 상태가 된다고 해서 바로 DB에 쿼리가 안 나가고 transaction.commit 되는 시점에 영속성 컨텍스트에 있는 것을 DB에 보낸다. ```

+ ```준영속 삭제 ``` <br> em.detach() :영속성 컨텍스트에서 다시 지운다. <br> em.remove() :실제 DB삭제를 요청하는 상태이다.

## 그러면 영속성 컨텍스트의 이점은 뭘까?
애플리케이션과 DB 사이에 '중간계층'이 있는 것으로, 중간에 있으면 '버퍼링'이 가능하며 '캐싱'이 가능하다.
